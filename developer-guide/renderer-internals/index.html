<!doctype html><html lang=en class=no-js><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn how Lite XL makes immediate-mode rendering fast and efficient."><meta name=author content="takase1121 <20792268+takase1121@users.noreply.github.com>"><link rel=canonical href=https://takase1121.github.io/lite-xl-docs/developer-guide/renderer-internals/><link rel=prev href=../views-toolbarview/><link rel=next href=../../about/contributors/><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.44"><title>How Renderer Works - Lite XL</title>
<link rel=stylesheet href=../../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../stylesheets/extra.a58208.min.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,t)=>(e<<5)-e+t.charCodeAt(0),0),__md_get=(e,t=localStorage,n=__md_scope)=>JSON.parse(t.getItem(n.pathname+"."+e)),__md_set=(e,t,n=localStorage,s=__md_scope)=>{try{n.setItem(s.pathname+"."+e,JSON.stringify(t))}catch{}}</script><meta property="og:type" content="website"><meta property="og:title" content="How Renderer Works - Lite XL"><meta property="og:description" content="Learn how Lite XL makes immediate-mode rendering fast and efficient."><meta property="og:image" content="https://takase1121.github.io/lite-xl-docs/assets/images/social/developer-guide/renderer-internals.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:url" content="https://takase1121.github.io/lite-xl-docs/developer-guide/renderer-internals/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="How Renderer Works - Lite XL"><meta name=twitter:description content="Learn how Lite XL makes immediate-mode rendering fast and efficient."><meta name=twitter:image content="https://takase1121.github.io/lite-xl-docs/assets/images/social/developer-guide/renderer-internals.png"><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>html.glightbox-open{overflow:initial;height:100%}.gslide-title{margin-top:0;user-select:text}.gslide-desc{color:#666;user-select:text}.gslide-image img{background:#fff}.gscrollbar-fixer{padding-right:15px}.gdesc-inner{font-size:.75rem}body[data-md-color-scheme=slate] .gdesc-inner{background:var(--md-default-bg-color)}body[data-md-color-scheme=slate] .gslide-title{color:var(--md-default-fg-color)}body[data-md-color-scheme=slate] .gslide-desc{color:var(--md-default-fg-color)}</style><script src=../../assets/javascripts/glightbox.min.js></script><body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo><input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off>
<input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off>
<label class=md-overlay for=__drawer></label><div data-md-component=skip><a href=#cached-software-rendering class=md-skip>Skip to content</a></div><div data-md-component=announce></div><div data-md-color-scheme=default data-md-component=outdated hidden></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a href=../.. title="Lite XL" class="md-header__button md-logo" aria-label="Lite XL" data-md-component=logo><img src=../../assets/icon.svg alt=logo>
</a><label class="md-header__button md-icon" for=__drawer><svg viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis>Lite XL</span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis>How Renderer Works</span></div></div></div><form class=md-header__option data-md-component=palette><input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0>
<label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewBox="0 0 24 24"><path d="M12 8a4 4 0 00-4 4 4 4 0 004 4 4 4 0 004-4 4 4 0 00-4-4m0 10a6 6 0 01-6-6 6 6 0 016-6 6 6 0 016 6 6 6 0 01-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
</label><input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1>
<label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewBox="0 0 24 24"><path d="M12 18c-.89.0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 016 6 6 6 0 01-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>if(palette=__md_get("__palette"),palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var palette,key,value,media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52.0 019.5 16 6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required>
<label class="md-search__icon md-icon" for=__search><svg viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52.0 019.5 16 6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg><svg viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav class=md-search__options aria-label=Search><button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1><svg viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav></form><div class=md-search__output><div class=md-search__scrollwrap tabindex=0 data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Initializing search</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a href=https://github.com/takase1121/lite-xl-docs title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87.0 00-40.81.0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34.0 01-48.55.0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86.0 000 40.81l195.61 195.6a28.86 28.86.0 0040.8.0l194.69-194.69a28.86 28.86.0 000-40.81"/></svg></div><div class=md-source__repository>GitHub</div></a></div></nav></header><div class=md-container data-md-component=container><nav class=md-tabs aria-label=Tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a href=../.. class=md-tabs__link>Home</a><li class=md-tabs__item><a href=../../setup/getting-started/ class=md-tabs__link>Set Up</a><li class=md-tabs__item><a href=../../user-guide/introduction/ class=md-tabs__link>User Guide</a><li class="md-tabs__item md-tabs__item--active"><a href=../introduction/ class=md-tabs__link>Developer Guide</a><li class=md-tabs__item><a href=../../about/contributors/ class=md-tabs__link>About</a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a href=../.. title="Lite XL" class="md-nav__button md-logo" aria-label="Lite XL" data-md-component=logo><img src=../../assets/icon.svg alt=logo>
</a>Lite XL</label><div class=md-nav__source><a href=https://github.com/takase1121/lite-xl-docs title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87.0 00-40.81.0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34.0 01-48.55.0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86.0 000 40.81l195.61 195.6a28.86 28.86.0 0040.8.0l194.69-194.69a28.86 28.86.0 000-40.81"/></svg></div><div class=md-source__repository>GitHub</div></a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../.. class=md-nav__link><span class=md-ellipsis>Home</span></a><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_2>
<label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0><span class=md-ellipsis>Set Up
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false><label class=md-nav__title for=__nav_2><span class="md-nav__icon md-icon"></span>
Set Up</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../../setup/getting-started/ class=md-nav__link><span class=md-ellipsis>Getting Started</span></a><li class=md-nav__item><a href=../../setup/install-from-package-managers/ class=md-nav__link><span class=md-ellipsis>Install from Package Managers</span></a><li class=md-nav__item><a href=../../setup/building-from-source/ class=md-nav__link><span class=md-ellipsis>Building from Source</span></a><li class=md-nav__item><a href=../../setup/platform-notes/ class=md-nav__link><span class=md-ellipsis>Platform-Specific Notes</span></a></ul></nav><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_3>
<label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0><span class=md-ellipsis>User Guide
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false><label class=md-nav__title for=__nav_3><span class="md-nav__icon md-icon"></span>
User Guide</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../../user-guide/introduction/ class=md-nav__link><span class=md-ellipsis>Introduction</span></a><li class=md-nav__item><a href=../../user-guide/configuration/ class=md-nav__link><span class=md-ellipsis>Configuration</span></a><li class=md-nav__item><a href=../../user-guide/managing-plugins/ class=md-nav__link><span class=md-ellipsis>Managing Plugins</span></a><li class=md-nav__item><a href=../../user-guide/ide-setup/ class=md-nav__link><span class=md-ellipsis>IDE Setup</span></a><li class=md-nav__item><a href=../../user-guide/lsp/ class=md-nav__link><span class=md-ellipsis>Language Server support</span></a><li class=md-nav__item><a href=../../user-guide/keymap/ class=md-nav__link><span class=md-ellipsis>Keymap</span></a><li class=md-nav__item><a href=../../user-guide/macos-keymap/ class=md-nav__link><span class=md-ellipsis>macOS Keymap</span></a></ul></nav><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_4 checked>
<label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex><span class=md-ellipsis>Developer Guide
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true><label class=md-nav__title for=__nav_4><span class="md-nav__icon md-icon"></span>
Developer Guide</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../introduction/ class=md-nav__link><span class=md-ellipsis>Introduction</span></a><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_4_2>
<label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0><span class=md-ellipsis>Syntaxes and Themes
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false><label class=md-nav__title for=__nav_4_2><span class="md-nav__icon md-icon"></span>
Syntaxes and Themes</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../creating-syntaxes/ class=md-nav__link><span class=md-ellipsis>Creating Syntaxes</span></a><li class=md-nav__item><a href=../creating-themes/ class=md-nav__link><span class=md-ellipsis>Creating Themes</span></a></ul></nav><li class=md-nav__item><a href=../commands/ class=md-nav__link><span class=md-ellipsis>Commands</span></a><li class=md-nav__item><a href=../managing-keyboard-shortcuts/ class=md-nav__link><span class=md-ellipsis>Managing Keyboard Shortcuts</span></a><li class=md-nav__item><a href=../classes-and-objects/ class=md-nav__link><span class=md-ellipsis>Classes and Objects</span></a><li class=md-nav__item><a href=../documents/ class=md-nav__link><span class=md-ellipsis>Documents</span></a><li class=md-nav__item><a href=../views/ class=md-nav__link><span class=md-ellipsis>Views</span></a><li class=md-nav__item><a href=../background-tasks/ class=md-nav__link><span class=md-ellipsis>Background Tasks</span></a><li class=md-nav__item><a href=../debugging/ class=md-nav__link><span class=md-ellipsis>Debugging</span></a><li class=md-nav__item><a href=../using-regular-expressions/ class=md-nav__link><span class=md-ellipsis>Using Regular Expressions</span></a><li class=md-nav__item><a href=../interacting-with-the-os/ class=md-nav__link><span class=md-ellipsis>Interacting with the OS</span></a><li class=md-nav__item><a href=../child-processes/ class=md-nav__link><span class=md-ellipsis>Child Processes</span></a><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_4_13>
<label class=md-nav__link for=__nav_4_13 id=__nav_4_13_label tabindex=0><span class=md-ellipsis>Samples
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_13_label aria-expanded=false><label class=md-nav__title for=__nav_4_13><span class="md-nav__icon md-icon"></span>
Samples</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../simple-plugin/ class=md-nav__link><span class=md-ellipsis>Simple Plugin</span></a><li class=md-nav__item><a href=../views-toolbarview/ class=md-nav__link><span class=md-ellipsis>ToolbarView</span></a></ul></nav><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_4_14 checked>
<label class=md-nav__link for=__nav_4_14 id=__nav_4_14_label tabindex=0><span class=md-ellipsis>Advanced Topics
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_14_label aria-expanded=true><label class=md-nav__title for=__nav_4_14><span class="md-nav__icon md-icon"></span>
Advanced Topics</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" type=checkbox id=__toc>
<label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis>How Renderer Works
</span><span class="md-nav__icon md-icon"></span>
</label><a href=./ class="md-nav__link md-nav__link--active"><span class=md-ellipsis>How Renderer Works</span></a><nav class="md-nav md-nav--secondary" aria-label="Table of contents"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span>
Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#cached-software-rendering class=md-nav__link><span class=md-ellipsis>Cached Software Rendering</span></a><nav class=md-nav aria-label="Cached Software Rendering"><ul class=md-nav__list><li class=md-nav__item><a href=#command-buffer class=md-nav__link><span class=md-ellipsis>Command Buffer</span></a><nav class=md-nav aria-label="Command Buffer"><ul class=md-nav__list><li class=md-nav__item><a href=#pushing-to-the-command-buffer class=md-nav__link><span class=md-ellipsis>Pushing to The Command Buffer</span></a></ul></nav><li class=md-nav__item><a href=#hash-grid class=md-nav__link><span class=md-ellipsis>Hash Grid</span></a><li class=md-nav__item><a href=#renderer class=md-nav__link><span class=md-ellipsis>Renderer</span></a></ul></nav><li class=md-nav__item><a href=#rendering-text-and-rectangles class=md-nav__link><span class=md-ellipsis>Rendering Text and Rectangles</span></a><nav class=md-nav aria-label="Rendering Text and Rectangles"><ul class=md-nav__list><li class=md-nav__item><a href=#rectangles class=md-nav__link><span class=md-ellipsis>Rectangles</span></a><li class=md-nav__item><a href=#text class=md-nav__link><span class=md-ellipsis>Text</span></a></ul></nav></ul></nav></ul></nav></ul></nav><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" type=checkbox id=__nav_5>
<label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0><span class=md-ellipsis>About
</span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false><label class=md-nav__title for=__nav_5><span class="md-nav__icon md-icon"></span>
About</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../../about/contributors/ class=md-nav__link><span class=md-ellipsis>Contributors</span></a><li class=md-nav__item><a href=../../about/faq/ class=md-nav__link><span class=md-ellipsis>FAQ</span></a></ul></nav></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary" aria-label="Table of contents"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span>
Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#cached-software-rendering class=md-nav__link><span class=md-ellipsis>Cached Software Rendering</span></a><nav class=md-nav aria-label="Cached Software Rendering"><ul class=md-nav__list><li class=md-nav__item><a href=#command-buffer class=md-nav__link><span class=md-ellipsis>Command Buffer</span></a><nav class=md-nav aria-label="Command Buffer"><ul class=md-nav__list><li class=md-nav__item><a href=#pushing-to-the-command-buffer class=md-nav__link><span class=md-ellipsis>Pushing to The Command Buffer</span></a></ul></nav><li class=md-nav__item><a href=#hash-grid class=md-nav__link><span class=md-ellipsis>Hash Grid</span></a><li class=md-nav__item><a href=#renderer class=md-nav__link><span class=md-ellipsis>Renderer</span></a></ul></nav><li class=md-nav__item><a href=#rendering-text-and-rectangles class=md-nav__link><span class=md-ellipsis>Rendering Text and Rectangles</span></a><nav class=md-nav aria-label="Rendering Text and Rectangles"><ul class=md-nav__list><li class=md-nav__item><a href=#rectangles class=md-nav__link><span class=md-ellipsis>Rectangles</span></a><li class=md-nav__item><a href=#text class=md-nav__link><span class=md-ellipsis>Text</span></a></ul></nav></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a href=https://github.com/takase1121/lite-xl-docs/edit/master/docs/developer-guide/renderer-internals.md title="Edit this page" class="md-content__button md-icon"><svg viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1.0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1.0.3.1.4.2l1.3 1.3c.2.2.2.6.0.8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
</a><a href=https://github.com/takase1121/lite-xl-docs/raw/master/docs/developer-guide/renderer-internals.md title="View source of this page" class="md-content__button md-icon"><svg viewBox="0 0 24 24"><path d="M17 18c.56.0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73.0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5A2.5 2.5.0 0114.5 19a2.5 2.5.0 012.5-2.5 2.5 2.5.0 012.5 2.5A2.5 2.5.0 0117 21.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6A2 2 0 004 4v16a2 2 0 002 2h4.5a8.2 8.2.0 01-1.23-2"/></svg></a><h1>How Renderer Works</h1><p>Lite XL is ubiquitous among other text editors as it uses an immediate-mode rendering
approach instead of conventional retained-mode rendering methods.
The immediate-mode approach allows the user to draw primitives on the screen directly,
per-frame, by inserting draw operations into a queue.
This is opposed to retained-mode rendering, where a complete object model is kept for
each primitive, and the client cleverly determines what to render and what not to render.<p>Lite XL allows the users to arbitrarily draw shapes and text in the order that they should
be presented — bottom to top where the bottom primitives can be occluded by ones on the top.
The following sequence is run "per-frame" to render the user interface.<ul><li><code>renderer.begin_frame()</code> is called.<li>Draw calls are made via <code>renderer.draw_text()</code>, <code>renderer.draw_rect()</code>, etc.<li><code>renderer.end_frame()</code> is called.<li>The primitives are rendered on the screen.</ul><h2 id=cached-software-rendering>Cached Software Rendering</h2><p>Lite XL inherits the cached software rendering used in <a href=https://github.com/rxi/lite>lite</a>.
The term is coined by <a href=https://github.com/rxi>rxi</a> in one of his <a href=https://rxi.github.io/cached_software_rendering.html>write-up</a> of the same title.
The approach provides an abstraction over dirty rectangles and is especially efficient
for applications where the UI changes a little between frames.
The application redraws the entire frame while the renderer figures out regions that
actually had to be redrawn, which reduces CPU time spent on rendering.<p>Lite XL implements a <strong>command buffer</strong>, <strong>hash grid</strong>, and a <strong>renderer</strong>.
The command buffer is a queue that stores a list of draw commands,
while the hash grid is used to store the difference between consecutive frames.
The renderer is used to draw the primitives on the screen.
The command buffer and hash grid implementation resides in <code class=highlight>src/rencache.<span class=o>{</span>h,c<span class=o>}</span></code>
while the renderer implementation is in <code class=highlight>src/renderer.<span class=o>{</span>h,c<span class=o>}</span></code>.
The high-level Lua API that uses these implementations are in <code>src/api/renderer.c</code>.<h3 id=command-buffer>Command Buffer</h3><p>You can find the following definition in <code>src/renwindow.h</code>:<div class=highlight><span class=filename>src/renwindow.h</span><pre><span></span><code><a id=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>struct</span><span class=w> </span><span class=nc>RenWindow</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>  </span><span class=n>SDL_Window</span><span class=w> </span><span class=o>*</span><span class=n>window</span><span class=p>;</span>
<a id=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=n>command_buf</span><span class=p>;</span>
<a id=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>  </span><span class=kt>size_t</span><span class=w> </span><span class=n>command_buf_idx</span><span class=p>;</span>
<a id=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>  </span><span class=kt>size_t</span><span class=w> </span><span class=n>command_buf_size</span><span class=p>;</span>
<a id=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>  </span><span class=kt>float</span><span class=w> </span><span class=n>scale_x</span><span class=p>;</span>
<a id=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=kt>float</span><span class=w> </span><span class=n>scale_y</span><span class=p>;</span>
<a id=__codelineno-0-8 href=#__codelineno-0-8></a><span class=cp>#ifdef LITE_USE_SDL_RENDERER</span>
<a id=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>  </span><span class=n>SDL_Renderer</span><span class=w> </span><span class=o>*</span><span class=n>renderer</span><span class=p>;</span>
<a id=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>  </span><span class=n>SDL_Texture</span><span class=w> </span><span class=o>*</span><span class=n>texture</span><span class=p>;</span>
<a id=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>  </span><span class=n>RenSurface</span><span class=w> </span><span class=n>rensurface</span><span class=p>;</span>
<a id=__codelineno-0-12 href=#__codelineno-0-12></a><span class=cp>#endif</span>
<a id=__codelineno-0-13 href=#__codelineno-0-13></a><span class=p>};</span>
</code></pre></div><p>The RenWindow struct defines a bunch of data that is needed to keep track of SDL windows.
Among those data is <code>command_buf</code>, <code>command_buf_idx</code> and <code>command_buf_size</code>.
You may wonder why the command buffer is stored as a pointer to a byte array,
but the following definition from <code>src/rencache.c</code> should reveal why:<div class=highlight><span class=filename>src/rencache.c</span><pre><span></span><code><a id=__codelineno-1-1 href=#__codelineno-1-1></a><span class=cp>#define CMD_BUF_RESIZE_RATE 1.2</span>
<a id=__codelineno-1-2 href=#__codelineno-1-2></a><span class=cp>#define CMD_BUF_INIT_SIZE (1024 * 512)</span>
<a id=__codelineno-1-3 href=#__codelineno-1-3></a><span class=cp>#define COMMAND_BARE_SIZE offsetof(Command, command)</span>
<a id=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 href=#__codelineno-1-5></a><span class=k>enum</span><span class=w> </span><span class=n>CommandType</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>SET_CLIP</span><span class=p>,</span><span class=w> </span><span class=n>DRAW_TEXT</span><span class=p>,</span><span class=w> </span><span class=n>DRAW_RECT</span><span class=w> </span><span class=p>};</span>
<a id=__codelineno-1-6 href=#__codelineno-1-6></a>
<a id=__codelineno-1-7 href=#__codelineno-1-7></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>  </span><span class=k>enum</span><span class=w> </span><span class=n>CommandType</span><span class=w> </span><span class=n>type</span><span class=p>;</span>
<a id=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>size</span><span class=p>;</span>
<a id=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>  </span><span class=cm>/* Commands *must* always begin with a RenRect</span>
<a id=__codelineno-1-11 href=#__codelineno-1-11></a><span class=cm>  ** This is done to ensure alignment */</span>
<a id=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>command</span><span class=p>[];</span>
<a id=__codelineno-1-13 href=#__codelineno-1-13></a><span class=p>}</span><span class=w> </span><span class=n>Command</span><span class=p>;</span>
<a id=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 href=#__codelineno-1-15></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>rect</span><span class=p>;</span>
<a id=__codelineno-1-17 href=#__codelineno-1-17></a><span class=p>}</span><span class=w> </span><span class=n>SetClipCommand</span><span class=p>;</span>
<a id=__codelineno-1-18 href=#__codelineno-1-18></a>
<a id=__codelineno-1-19 href=#__codelineno-1-19></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>rect</span><span class=p>;</span>
<a id=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>  </span><span class=n>RenColor</span><span class=w> </span><span class=n>color</span><span class=p>;</span>
<a id=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>  </span><span class=n>RenFont</span><span class=w> </span><span class=o>*</span><span class=n>fonts</span><span class=p>[</span><span class=n>FONT_FALLBACK_MAX</span><span class=p>];</span>
<a id=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>  </span><span class=kt>float</span><span class=w> </span><span class=n>text_x</span><span class=p>;</span>
<a id=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>  </span><span class=kt>size_t</span><span class=w> </span><span class=n>len</span><span class=p>;</span>
<a id=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>  </span><span class=kt>int8_t</span><span class=w> </span><span class=n>tab_size</span><span class=p>;</span>
<a id=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>  </span><span class=kt>char</span><span class=w> </span><span class=n>text</span><span class=p>[];</span>
<a id=__codelineno-1-27 href=#__codelineno-1-27></a><span class=p>}</span><span class=w> </span><span class=n>DrawTextCommand</span><span class=p>;</span>
<a id=__codelineno-1-28 href=#__codelineno-1-28></a>
<a id=__codelineno-1-29 href=#__codelineno-1-29></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>rect</span><span class=p>;</span>
<a id=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>  </span><span class=n>RenColor</span><span class=w> </span><span class=n>color</span><span class=p>;</span>
<a id=__codelineno-1-32 href=#__codelineno-1-32></a><span class=p>}</span><span class=w> </span><span class=n>DrawRectCommand</span><span class=p>;</span>
</code></pre></div><p>The <code>Command</code> struct represents the base type for all other commands.
It contains the type of the command, the size of the command and a variable-sized field
containing a subtype of <code>Command</code> such as <code>DrawTextCommand</code>.
<code>SetClipCommand</code>, <code>DrawTextCommand</code> and <code>DrawRectCommand</code> are all subclasses of
<code>Command</code> (very loosely though, since C does not support object-oriented programming).
Instead of making <code>Command</code> a union of <code>SetClipCommand</code>, <code>DrawTextCommand</code> and <code>DrawRectCommand</code>,
we use <code>offsetof</code> and <code>alignof</code> operators introduced in C11 to determine the alignment
between different draw commands.
This approach allows us to store draw operations efficiently as unions has the size of its largest member.<h4 id=pushing-to-the-command-buffer>Pushing to The Command Buffer</h4><p>When calling the <code>renderer.draw_text()</code> in Lua, <code>rencache_draw_text()</code> is called in the C side.
The function calculates the bounding box of the text being rendered,
and stores it into the command buffer.<div class=highlight><span class=filename>src/rencache.c</span><pre><span></span><code><a id=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kt>double</span><span class=w> </span><span class=nf>rencache_draw_text</span><span class=p>(</span><span class=n>RenWindow</span><span class=w> </span><span class=o>*</span><span class=n>window_renderer</span><span class=p>,</span><span class=w> </span><span class=n>RenFont</span><span class=w> </span><span class=o>**</span><span class=n>fonts</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>len</span><span class=p>,</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>RenColor</span><span class=w> </span><span class=n>color</span><span class=p>)</span>
<a id=__codelineno-2-2 href=#__codelineno-2-2></a><span class=p>{</span>
<a id=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>x_offset</span><span class=p>;</span>
<a id=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>  </span><span class=kt>double</span><span class=w> </span><span class=n>width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ren_font_group_get_width</span><span class=p>(</span><span class=n>fonts</span><span class=p>,</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>x_offset</span><span class=p>);</span>
<a id=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>rect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>x_offset</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)(</span><span class=n>width</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>x_offset</span><span class=p>),</span><span class=w> </span><span class=n>ren_font_group_get_height</span><span class=p>(</span><span class=n>fonts</span><span class=p>)</span><span class=w> </span><span class=p>};</span>
<a id=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>rects_overlap</span><span class=p>(</span><span class=n>last_clip_rect</span><span class=p>,</span><span class=w> </span><span class=n>rect</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<a id=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>    </span><span class=n>DrawTextCommand</span><span class=w> </span><span class=o>*</span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>push_command</span><span class=p>(</span><span class=n>window_renderer</span><span class=p>,</span><span class=w> </span><span class=n>DRAW_TEXT</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>DrawTextCommand</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sz</span><span class=p>);</span>
<a id=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>      </span><span class=n>memcpy</span><span class=p>(</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>sz</span><span class=p>);</span>
<a id=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>      </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>color</span><span class=p>;</span>
<a id=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>      </span><span class=n>memcpy</span><span class=p>(</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>fonts</span><span class=p>,</span><span class=w> </span><span class=n>fonts</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>RenFont</span><span class=o>*</span><span class=p>)</span><span class=o>*</span><span class=n>FONT_FALLBACK_MAX</span><span class=p>);</span>
<a id=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>      </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>rect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rect</span><span class=p>;</span>
<a id=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>      </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>text_x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<a id=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>      </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>len</span><span class=p>;</span>
<a id=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>      </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>tab_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ren_font_group_get_tab_size</span><span class=p>(</span><span class=n>fonts</span><span class=p>);</span>
<a id=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-2-18 href=#__codelineno-2-18></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-2-19 href=#__codelineno-2-19></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>width</span><span class=p>;</span>
<a id=__codelineno-2-20 href=#__codelineno-2-20></a><span class=p>}</span>
</code></pre></div><p>The function allocates sufficient space to store the parameters, including the string to render,
with a suitable alignment for the system that Lite XL runs on.
Older versions of Lite XL will skip the draw call if the command buffer is full,
but recent versions of Lite XL will attempt to enlarge the command buffer before doing so.<p>Once space is allocated, the bounding box of the text is calculated and stored into the buffer,
along with the text content and starting coordinates.
Coincidentally, this function illustrates one of the limitations of Lite XL's rendering system,
where the font width calculation is often redundant (in Lua and in here).<p>When <code>renderer.end_frame()</code> is called, the commands inside the buffer is used to populate
the hash grid, and to perform a render pass.
When everything is complete, <code>window->command_buf_idx</code> is set to 0 to clear the command buffer.<h3 id=hash-grid>Hash Grid</h3><p>The hash grid is responsible for storing the changes between consecutive frames.
As its name implies, the hash grid does not store actual pixel data,
but hashes of the pixel data in a grid.
The following definitions in <code>src/rencache.c</code> is clear on how the hash grids are stored:<div class=highlight><span class=filename>src/rencache.c</span><pre><span></span><code><a id=__codelineno-3-1 href=#__codelineno-3-1></a><span class=cp>#define CELLS_X 80</span>
<a id=__codelineno-3-2 href=#__codelineno-3-2></a><span class=cp>#define CELLS_Y 50</span>
<a id=__codelineno-3-3 href=#__codelineno-3-3></a><span class=cp>#define CELL_SIZE 96</span>
<a id=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>static</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=n>cells_buf1</span><span class=p>[</span><span class=n>CELLS_X</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>CELLS_Y</span><span class=p>];</span>
<a id=__codelineno-3-6 href=#__codelineno-3-6></a><span class=k>static</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=n>cells_buf2</span><span class=p>[</span><span class=n>CELLS_X</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>CELLS_Y</span><span class=p>];</span>
<a id=__codelineno-3-7 href=#__codelineno-3-7></a><span class=k>static</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=o>*</span><span class=n>cells_prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cells_buf1</span><span class=p>;</span>
<a id=__codelineno-3-8 href=#__codelineno-3-8></a><span class=k>static</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=o>*</span><span class=n>cells</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cells_buf2</span><span class=p>;</span>
<a id=__codelineno-3-9 href=#__codelineno-3-9></a><span class=k>static</span><span class=w> </span><span class=n>RenRect</span><span class=w> </span><span class=n>rect_buf</span><span class=p>[</span><span class=n>CELLS_X</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>CELLS_Y</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=p>];</span>
<a id=__codelineno-3-10 href=#__codelineno-3-10></a><span class=k>static</span><span class=w> </span><span class=n>RenRect</span><span class=w> </span><span class=n>screen_rect</span><span class=p>;</span>
<a id=__codelineno-3-11 href=#__codelineno-3-11></a><span class=k>static</span><span class=w> </span><span class=n>RenRect</span><span class=w> </span><span class=n>last_clip_rect</span><span class=p>;</span>
</code></pre></div><p>Lite XL divides the screen into squares of 96 pixels each, and stores the hash for each square.
But, that is actually not quite what Lite XL does.
Consider the following code:<div class=highlight><span class=filename>src/rencache.c</span><pre><span></span><code><a id=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>update_overlapping_cells</span><span class=p>(</span><span class=n>RenRect</span><span class=w> </span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=n>h</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>x1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>CELL_SIZE</span><span class=p>;</span>
<a id=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>y1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>CELL_SIZE</span><span class=p>;</span>
<a id=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>x2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>r</span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>width</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>CELL_SIZE</span><span class=p>;</span>
<a id=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>y2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>r</span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>height</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>CELL_SIZE</span><span class=p>;</span>
<a id=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y1</span><span class=p>;</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>y2</span><span class=p>;</span><span class=w> </span><span class=n>y</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x1</span><span class=p>;</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>x2</span><span class=p>;</span><span class=w> </span><span class=n>x</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>      </span><span class=kt>int</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cell_idx</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span>
<a id=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>      </span><span class=n>hash</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cells</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>h</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>h</span><span class=p>));</span>
<a id=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-4-13 href=#__codelineno-4-13></a><span class=p>}</span>
<a id=__codelineno-4-14 href=#__codelineno-4-14></a>
<a id=__codelineno-4-15 href=#__codelineno-4-15></a><span class=kt>void</span><span class=w> </span><span class=nf>rencache_end_frame</span><span class=p>(</span><span class=n>RenWindow</span><span class=w> </span><span class=o>*</span><span class=n>window_renderer</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-16 href=#__codelineno-4-16></a><span class=cm>/* update cells from commands */</span>
<a id=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>  </span><span class=n>Command</span><span class=w> </span><span class=o>*</span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>NULL</span><span class=p>;</span>
<a id=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>cr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>screen_rect</span><span class=p>;</span>
<a id=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>next_command</span><span class=p>(</span><span class=n>window_renderer</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cmd</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-20 href=#__codelineno-4-20></a><span class=w>    </span><span class=cm>/* cmd-&gt;command[0] should always be the Command rect */</span>
<a id=__codelineno-4-21 href=#__codelineno-4-21></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>type</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>SET_CLIP</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>cr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>command</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>    </span><span class=n>RenRect</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>intersect_rects</span><span class=p>(</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>command</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=n>cr</span><span class=p>);</span>
<a id=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>r</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>height</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>continue</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-4-24 href=#__codelineno-4-24></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HASH_INITIAL</span><span class=p>;</span>
<a id=__codelineno-4-25 href=#__codelineno-4-25></a><span class=w>    </span><span class=n>hash</span><span class=p>(</span><span class=o>&amp;</span><span class=n>h</span><span class=p>,</span><span class=w> </span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>);</span>
<a id=__codelineno-4-26 href=#__codelineno-4-26></a><span class=w>    </span><span class=n>update_overlapping_cells</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>h</span><span class=p>);</span>
<a id=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-4-28 href=#__codelineno-4-28></a>
<a id=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>  </span><span class=cm>/* push rects for all cells changed from last frame, reset cells */</span>
<a id=__codelineno-4-30 href=#__codelineno-4-30></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>rect_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<a id=__codelineno-4-31 href=#__codelineno-4-31></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>max_x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>screen_rect</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>CELL_SIZE</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<a id=__codelineno-4-32 href=#__codelineno-4-32></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>max_y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>screen_rect</span><span class=p>.</span><span class=n>height</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>CELL_SIZE</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<a id=__codelineno-4-33 href=#__codelineno-4-33></a><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>max_y</span><span class=p>;</span><span class=w> </span><span class=n>y</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-34 href=#__codelineno-4-34></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>max_x</span><span class=p>;</span><span class=w> </span><span class=n>x</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-35 href=#__codelineno-4-35></a><span class=w>      </span><span class=cm>/* compare previous and current cell for change */</span>
<a id=__codelineno-4-36 href=#__codelineno-4-36></a><span class=w>      </span><span class=kt>int</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cell_idx</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span>
<a id=__codelineno-4-37 href=#__codelineno-4-37></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cells</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>cells_prev</span><span class=p>[</span><span class=n>idx</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-38 href=#__codelineno-4-38></a><span class=w>        </span><span class=n>push_rect</span><span class=p>((</span><span class=n>RenRect</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=o>&amp;</span><span class=n>rect_count</span><span class=p>);</span>
<a id=__codelineno-4-39 href=#__codelineno-4-39></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-4-40 href=#__codelineno-4-40></a><span class=w>      </span><span class=n>cells_prev</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HASH_INITIAL</span><span class=p>;</span>
<a id=__codelineno-4-41 href=#__codelineno-4-41></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-42 href=#__codelineno-4-42></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-4-43 href=#__codelineno-4-43></a><span class=w>  </span><span class=c1>// rest of the code goes here...</span>
<a id=__codelineno-4-44 href=#__codelineno-4-44></a><span class=p>}</span>
</code></pre></div><p>We can clearly see that the code actually hashes the command instead of pixel data.
The hashed command is saved to grid cells that were affected.
The grid cells were then compared to determine the regions that needed to be redrawn.<p>After the frame has been drawn, the hash grids for the current and previous frames are
swapped to prepare for the next frame.<h3 id=renderer>Renderer</h3><p>After the regions are determined, the commands are used to call the renderer to render
primitives to the screen.<div class=highlight><span class=filename>src/rencache.c</span><pre><span></span><code><a id=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>rect_count</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>  </span><span class=cm>/* draw */</span>
<a id=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span><span class=n>RenRect</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rect_buf</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
<a id=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>  </span><span class=n>ren_set_clip_rect</span><span class=p>(</span><span class=n>window_renderer</span><span class=p>,</span><span class=w> </span><span class=n>r</span><span class=p>);</span>
<a id=__codelineno-5-5 href=#__codelineno-5-5></a>
<a id=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>  </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>NULL</span><span class=p>;</span>
<a id=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>next_command</span><span class=p>(</span><span class=n>window_renderer</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cmd</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span><span class=n>SetClipCommand</span><span class=w> </span><span class=o>*</span><span class=n>ccmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>SetClipCommand</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>command</span><span class=p>;</span>
<a id=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span><span class=n>DrawRectCommand</span><span class=w> </span><span class=o>*</span><span class=n>rcmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>DrawRectCommand</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>command</span><span class=p>;</span>
<a id=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=n>DrawTextCommand</span><span class=w> </span><span class=o>*</span><span class=n>tcmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>DrawTextCommand</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>command</span><span class=p>;</span>
<a id=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>cmd</span><span class=o>-&gt;</span><span class=n>type</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=no>SET_CLIP</span><span class=p>:</span>
<a id=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>        </span><span class=n>ren_set_clip_rect</span><span class=p>(</span><span class=n>window_renderer</span><span class=p>,</span><span class=w> </span><span class=n>intersect_rects</span><span class=p>(</span><span class=n>ccmd</span><span class=o>-&gt;</span><span class=n>rect</span><span class=p>,</span><span class=w> </span><span class=n>r</span><span class=p>));</span>
<a id=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span><span class=k>break</span><span class=p>;</span>
<a id=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=no>DRAW_RECT</span><span class=p>:</span>
<a id=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>        </span><span class=n>ren_draw_rect</span><span class=p>(</span><span class=o>&amp;</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>rect</span><span class=p>,</span><span class=w> </span><span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>color</span><span class=p>);</span>
<a id=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>        </span><span class=k>break</span><span class=p>;</span>
<a id=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=no>DRAW_TEXT</span><span class=p>:</span>
<a id=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>        </span><span class=n>ren_font_group_set_tab_size</span><span class=p>(</span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>fonts</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>tab_size</span><span class=p>);</span>
<a id=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>        </span><span class=n>ren_draw_text</span><span class=p>(</span><span class=o>&amp;</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>fonts</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>text_x</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>rect</span><span class=p>.</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>tcmd</span><span class=o>-&gt;</span><span class=n>color</span><span class=p>);</span>
<a id=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>        </span><span class=k>break</span><span class=p>;</span>
<a id=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-5-24 href=#__codelineno-5-24></a><span class=p>}</span>
</code></pre></div><p>Primitives outside the current clip rectangle does not get rendered.
Although the code still goes through the command buffer for each updated region,
the renderer call itself were basically no-ops on unmodified regions due to the clip rectangle.
Moreover, updated regions are passed to <code>SDL_UpdateWindowSurfaceRects()</code>,
which prevents SDL from copying unmodified regions of the buffer to the screen.<h2 id=rendering-text-and-rectangles>Rendering Text and Rectangles</h2><p>Lite XL uses a very simple renderer that directly manipulates pixel data,
instead of leveraging higher-level graphics library such as Cairo and Skia.
The renderer is only capable of drawing rectangles and text.<h3 id=rectangles>Rectangles</h3><p>Drawing a rectangle is trivial, as it only requires copying pixels for N amount of times.
Lite XL doesn't attempt to implement this pixel-copying loop by itself,
instead it uses <code>SDL_FillRect()</code> (and <code>SDL_BlitScaled()</code> when the rectangle is not transparent),
which is heavily optimized by SDL.<h3 id=text>Text</h3><p>Drawing text is slightly more complicated.
Lite XL rasterizes each glyph (a graphical representation of a character) with FreeType,
and then stores the bitmap and dimensions inside a font object.
When <code>renderer.draw_text()</code> is called, the glyph bitmap and dimensions are retrieved,
and the bitmap is copied to the output according to the parameters and dimensions.<p>The text renderer received a <a href=https://github.com/lite-xl/lite-xl/pull/1845>major overhaul</a> which improved performance.
Previously, Lite XL stored glyph bitmaps and dimensions in a hash table mapped by
Unicode codepoints, which is inefficient as there can be as many as 1,114,111 valid Unicode codepoints,
while the <a href=https://learn.microsoft.com/en-us/typography/opentype/spec/cmap#format-4-segment-mapping-to-delta-values>OpenType standard</a> only allowed 65,536 glyphs per font.
Many font operations also require interacting with glyph IDs instead of codepoints, which made it inflexible.
Other than that, the renderer will render 256 glyphs when only one glyph is required,
which has a significant performance impact on non-Latin fonts (CJK fonts).
Testing has shown that loading a file with CJK characters <a href=https://github.com/lite-xl/lite-xl/pull/1845#issue-2387413408>can take seconds</a>.<p>The current renderer maintains two hash tables called GlyphMap and CharMap respectively.
CharMap maps Unicode codepoints to glyph IDs, while GlyphMap maps glyph IDs to glyph bitmaps and dimensions.
This reduces memory required to store the glyphs as glyph IDs are 16-bit unsigned integers,
and we only need to store 65,536 glyph bitmap slots.
It also allows us to remap certain codepoints to other glyphs, but this has not been done in practice.
The following snippet illustrates the data structures for storing font data.<div class=highlight><span class=filename>src/renderer.c</span><pre><span></span><code><a id=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1>// approximate number of glyphs per atlas surface</span>
<a id=__codelineno-6-2 href=#__codelineno-6-2></a><span class=cp>#define GLYPHS_PER_ATLAS 256</span>
<a id=__codelineno-6-3 href=#__codelineno-6-3></a><span class=c1>// some padding to add to atlas surface to store more glyphs</span>
<a id=__codelineno-6-4 href=#__codelineno-6-4></a><span class=cp>#define FONT_HEIGHT_OVERFLOW_PX 6</span>
<a id=__codelineno-6-5 href=#__codelineno-6-5></a><span class=cp>#define FONT_WIDTH_OVERFLOW_PX 6</span>
<a id=__codelineno-6-6 href=#__codelineno-6-6></a>
<a id=__codelineno-6-7 href=#__codelineno-6-7></a><span class=c1>// maximum unicode codepoint supported (https://stackoverflow.com/a/52203901)</span>
<a id=__codelineno-6-8 href=#__codelineno-6-8></a><span class=cp>#define MAX_UNICODE 0x10FFFF</span>
<a id=__codelineno-6-9 href=#__codelineno-6-9></a><span class=c1>// number of rows and columns in the codepoint map</span>
<a id=__codelineno-6-10 href=#__codelineno-6-10></a><span class=cp>#define CHARMAP_ROW 128</span>
<a id=__codelineno-6-11 href=#__codelineno-6-11></a><span class=cp>#define CHARMAP_COL (MAX_UNICODE / CHARMAP_ROW)</span>
<a id=__codelineno-6-12 href=#__codelineno-6-12></a>
<a id=__codelineno-6-13 href=#__codelineno-6-13></a><span class=c1>// the maximum number of glyphs for OpenType</span>
<a id=__codelineno-6-14 href=#__codelineno-6-14></a><span class=cp>#define MAX_GLYPHS 65535</span>
<a id=__codelineno-6-15 href=#__codelineno-6-15></a><span class=c1>// number of rows and columns in the glyph map</span>
<a id=__codelineno-6-16 href=#__codelineno-6-16></a><span class=cp>#define GLYPHMAP_ROW 128</span>
<a id=__codelineno-6-17 href=#__codelineno-6-17></a><span class=cp>#define GLYPHMAP_COL (MAX_GLYPHS / GLYPHMAP_ROW)</span>
<a id=__codelineno-6-18 href=#__codelineno-6-18></a>
<a id=__codelineno-6-19 href=#__codelineno-6-19></a><span class=c1>// number of subpixel bitmaps</span>
<a id=__codelineno-6-20 href=#__codelineno-6-20></a><span class=cp>#define SUBPIXEL_BITMAPS_CACHED 3</span>
<a id=__codelineno-6-21 href=#__codelineno-6-21></a>
<a id=__codelineno-6-22 href=#__codelineno-6-22></a><span class=k>typedef</span><span class=w> </span><span class=k>enum</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>  </span><span class=n>EGlyphNone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>  </span><span class=n>EGlyphLoaded</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mf>0L</span><span class=p>),</span>
<a id=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>  </span><span class=n>EGlyphBitmap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mf>1L</span><span class=p>),</span>
<a id=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>  </span><span class=c1>// currently no-op because blits are always assumed to be dual source</span>
<a id=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>  </span><span class=n>EGlyphDualSource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mf>2L</span><span class=p>),</span>
<a id=__codelineno-6-28 href=#__codelineno-6-28></a><span class=p>}</span><span class=w> </span><span class=n>ERenGlyphFlags</span><span class=p>;</span>
<a id=__codelineno-6-29 href=#__codelineno-6-29></a>
<a id=__codelineno-6-30 href=#__codelineno-6-30></a><span class=c1>// metrics for a loaded glyph</span>
<a id=__codelineno-6-31 href=#__codelineno-6-31></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-32 href=#__codelineno-6-32></a><span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>short</span><span class=w> </span><span class=n>atlas_idx</span><span class=p>,</span><span class=w> </span><span class=n>surface_idx</span><span class=p>;</span>
<a id=__codelineno-6-33 href=#__codelineno-6-33></a><span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>x1</span><span class=p>,</span><span class=w> </span><span class=n>y0</span><span class=p>,</span><span class=w> </span><span class=n>y1</span><span class=p>,</span><span class=w> </span><span class=n>flags</span><span class=p>;</span>
<a id=__codelineno-6-34 href=#__codelineno-6-34></a><span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>bitmap_left</span><span class=p>,</span><span class=w> </span><span class=n>bitmap_top</span><span class=p>;</span>
<a id=__codelineno-6-35 href=#__codelineno-6-35></a><span class=w>  </span><span class=kt>float</span><span class=w> </span><span class=n>xadvance</span><span class=p>;</span>
<a id=__codelineno-6-36 href=#__codelineno-6-36></a><span class=p>}</span><span class=w> </span><span class=n>GlyphMetric</span><span class=p>;</span>
<a id=__codelineno-6-37 href=#__codelineno-6-37></a>
<a id=__codelineno-6-38 href=#__codelineno-6-38></a><span class=c1>// maps codepoints -&gt; glyph IDs</span>
<a id=__codelineno-6-39 href=#__codelineno-6-39></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-40 href=#__codelineno-6-40></a><span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=o>*</span><span class=n>rows</span><span class=p>[</span><span class=n>CHARMAP_ROW</span><span class=p>];</span>
<a id=__codelineno-6-41 href=#__codelineno-6-41></a><span class=p>}</span><span class=w> </span><span class=n>CharMap</span><span class=p>;</span>
<a id=__codelineno-6-42 href=#__codelineno-6-42></a>
<a id=__codelineno-6-43 href=#__codelineno-6-43></a><span class=c1>// a bitmap atlas with a fixed width, each surface acting as a bump allocator</span>
<a id=__codelineno-6-44 href=#__codelineno-6-44></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-45 href=#__codelineno-6-45></a><span class=w>  </span><span class=n>SDL_Surface</span><span class=w> </span><span class=o>**</span><span class=n>surfaces</span><span class=p>;</span>
<a id=__codelineno-6-46 href=#__codelineno-6-46></a><span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>width</span><span class=p>,</span><span class=w> </span><span class=n>nsurface</span><span class=p>;</span>
<a id=__codelineno-6-47 href=#__codelineno-6-47></a><span class=p>}</span><span class=w> </span><span class=n>GlyphAtlas</span><span class=p>;</span>
<a id=__codelineno-6-48 href=#__codelineno-6-48></a>
<a id=__codelineno-6-49 href=#__codelineno-6-49></a><span class=c1>// maps glyph IDs -&gt; glyph metrics</span>
<a id=__codelineno-6-50 href=#__codelineno-6-50></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-51 href=#__codelineno-6-51></a><span class=w>  </span><span class=c1>// accessed with metrics[bitmap_idx][glyph_id / nrow][glyph_id - (row * ncol)]</span>
<a id=__codelineno-6-52 href=#__codelineno-6-52></a><span class=w>  </span><span class=n>GlyphMetric</span><span class=w> </span><span class=o>*</span><span class=n>metrics</span><span class=p>[</span><span class=n>SUBPIXEL_BITMAPS_CACHED</span><span class=p>][</span><span class=n>GLYPHMAP_ROW</span><span class=p>];</span>
<a id=__codelineno-6-53 href=#__codelineno-6-53></a><span class=w>  </span><span class=c1>// accessed with atlas[bitmap_idx][atlas_idx].surfaces[surface_idx]</span>
<a id=__codelineno-6-54 href=#__codelineno-6-54></a><span class=w>  </span><span class=n>GlyphAtlas</span><span class=w> </span><span class=o>*</span><span class=n>atlas</span><span class=p>[</span><span class=n>SUBPIXEL_BITMAPS_CACHED</span><span class=p>];</span>
<a id=__codelineno-6-55 href=#__codelineno-6-55></a><span class=w>  </span><span class=kt>size_t</span><span class=w> </span><span class=n>natlas</span><span class=p>,</span><span class=w> </span><span class=n>bytesize</span><span class=p>;</span>
<a id=__codelineno-6-56 href=#__codelineno-6-56></a><span class=p>}</span><span class=w> </span><span class=n>GlyphMap</span><span class=p>;</span>
<a id=__codelineno-6-57 href=#__codelineno-6-57></a>
<a id=__codelineno-6-58 href=#__codelineno-6-58></a><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>RenFont</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-59 href=#__codelineno-6-59></a><span class=w>  </span><span class=n>FT_Face</span><span class=w> </span><span class=n>face</span><span class=p>;</span>
<a id=__codelineno-6-60 href=#__codelineno-6-60></a><span class=w>  </span><span class=n>CharMap</span><span class=w> </span><span class=n>charmap</span><span class=p>;</span>
<a id=__codelineno-6-61 href=#__codelineno-6-61></a><span class=w>  </span><span class=n>GlyphMap</span><span class=w> </span><span class=n>glyphs</span><span class=p>;</span>
<a id=__codelineno-6-62 href=#__codelineno-6-62></a><span class=w>  </span><span class=c1>// other info...</span>
<a id=__codelineno-6-63 href=#__codelineno-6-63></a><span class=p>}</span><span class=w> </span><span class=n>RenFont</span><span class=p>;</span>
</code></pre></div><p>When a character is requested, the glyph finds the glyph ID of the codepoint with
<code>FT_Get_Char_Index()</code> and caches the result in the CharMap.
The CharMap allows fast lookup of what glyphs are available in a font,
and is used to implement font fallback.<p>The glyph ID is used to look up the metrics, which will be loaded with <code>FT_Load_Glyph()</code>
if it is not cached.
Lite XL stores multiple "stages" of metrics, the first one being only the X advance.
The X advance can be calculated from the glyph outline and doesn't require rasterization.
This is useful when the user only wants to know the width of a string,
frequently used in <code>View:update()</code> calls.<p>If the user requires the bitmap, then the renderer renders it with <code>FT_Render_Glyph()</code>.
When subpixel rendering is enabled, the renderer renders 3 variations of the glyph,
shifted by 1 subpixel.
The rendered glyph bitmap can either be 24-bit RGB, 8-bit monochrome or grayscale,
or potentially a <a href=https://github.com/lite-xl/lite-xl/pull/1860>32-bit RGBA</a> bitmap.
Space is allocated in the atlas for the specified bitmap type and height, and the bitmap
is copied into the atlas.
The atlas ID and index, top-left and bottom-right coordinates,
along with other glyph information are recorded.<p>When the glyph bitmap and dimensions are loaded, it can be used to render text on the screen.
The renderer loops through each codepoint in the input string and loads the glyphs
corresponding to the codepoint.
If the codepoint is found, the renderer will return the glyph bitmap and dimension.
If a font does not have glyphs for the codepoint, the renderer will look for other fonts
(if a <code>FontGroup</code> was passed into the renderer) for the glyph.<p>If none of the fonts specified have the glyph, the renderer will attempt to get the
"fallback" character (usually displayed as blank squares with a cross);
and if that doesn't exist either, the White Square character (<code>U+25A1</code>).
Finally, if none of the glyphs are available, the renderer simply draws a rectangle in place.<p>The glyph bitmap is copied to the screen with the following formula:<div class=highlight><span class=filename>src/renderer.c</span><pre><span></span><code><a id=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>color</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>src</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dst</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>65025</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>src</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>32767</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>65025</span><span class=p>;</span>
<a id=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>color</span><span class=p>.</span><span class=n>g</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>src</span><span class=p>.</span><span class=n>g</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dst</span><span class=p>.</span><span class=n>g</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>65025</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>src</span><span class=p>.</span><span class=n>g</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>32767</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>65025</span><span class=p>;</span>
<a id=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>color</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>src</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dst</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>65025</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>src</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>32767</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>65025</span><span class=p>;</span>
</code></pre></div><p>The formula performs dual-source blending to properly blend the foreground, background
and text color.<div class="admonition note"><p class=admonition-title>Author's Note<p>As of today (20/11/2024), I have no idea what the formula does.
It is modified in <a href=https://github.com/lite-xl/lite-xl/pull/619>lite-xl#619</a> and there are no description of where the magic
numbers in the formula come from.
The closest match I can find is the following formula from <a href=https://www.puredevsoftware.com/blog/2019/01/22/sub-pixel-gamma-correct-font-rendering/>this blog post</a>:<div class=highlight><pre><span></span><code><a id=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>// convert the vertex colour to linear space</span>
<a id=__codelineno-8-2 href=#__codelineno-8-2></a><span class=kt>vec4</span><span class=w> </span><span class=n>v_colour_linear</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pow4</span><span class=p>(</span><span class=n>v_colour</span><span class=p>,</span><span class=w> </span><span class=n>inv_gamma</span><span class=p>);</span>
<a id=__codelineno-8-3 href=#__codelineno-8-3></a>
<a id=__codelineno-8-4 href=#__codelineno-8-4></a><span class=c1>// convert the background colour to linear space</span>
<a id=__codelineno-8-5 href=#__codelineno-8-5></a><span class=kt>vec4</span><span class=w> </span><span class=n>v_background_colour_linear</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pow4</span><span class=p>(</span><span class=n>v_background_colour</span><span class=p>,</span><span class=w> </span><span class=n>inv_gamma</span><span class=p>);</span>
<a id=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 href=#__codelineno-8-7></a><span class=c1>// blend</span>
<a id=__codelineno-8-8 href=#__codelineno-8-8></a><span class=kt>float</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_colour_linear</span><span class=p>.</span><span class=n>r</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_background_colour_linear</span><span class=p>.</span><span class=n>r</span><span class=p>;</span>
<a id=__codelineno-8-9 href=#__codelineno-8-9></a><span class=kt>float</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>g</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_colour_linear</span><span class=p>.</span><span class=n>g</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>g</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_background_colour_linear</span><span class=p>.</span><span class=n>g</span><span class=p>;</span>
<a id=__codelineno-8-10 href=#__codelineno-8-10></a><span class=kt>float</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_colour_linear</span><span class=p>.</span><span class=n>b</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_background_colour_linear</span><span class=p>.</span><span class=n>b</span><span class=p>;</span>
<a id=__codelineno-8-11 href=#__codelineno-8-11></a>
<a id=__codelineno-8-12 href=#__codelineno-8-12></a><span class=c1>// gamma encode the result</span>
<a id=__codelineno-8-13 href=#__codelineno-8-13></a><span class=nb>gl_FragColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pow4</span><span class=p>(</span><span class=kt>vec4</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=n>tex_col</span><span class=p>.</span><span class=n>a</span><span class=p>),</span><span class=w> </span><span class=n>gamma</span><span class=p>);</span>
</code></pre></div></div><aside class=md-source-file><span class=md-source-file__fact><span class=md-icon title="Last update"><svg viewBox="0 0 24 24"><path d="M21 13.1c-.1.0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6.0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3.0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4.0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
</span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 20, 2024</span></span></aside></article></div><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button type=button class="md-top md-icon" data-md-component=top hidden>
<svg viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
Back to top</button></main><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a href=../views-toolbarview/ class="md-footer__link md-footer__link--prev" aria-label="Previous: ToolbarView"><div class="md-footer__button md-icon"><svg viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></div><div class=md-footer__title><span class=md-footer__direction>Previous</span><div class=md-ellipsis>ToolbarView</div></div></a><a href=../../about/contributors/ class="md-footer__link md-footer__link--next" aria-label="Next: Contributors"><div class=md-footer__title><span class=md-footer__direction>Next</span><div class=md-ellipsis>Contributors</div></div><div class="md-footer__button md-icon"><svg viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright>Made with
<a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener>Material for MkDocs</a></div><div class=md-social><a href=https://github.com/lite-xl/lite-xl target=_blank rel=noopener title=github.com class=md-social__link><svg viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6.0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
</a><a href=https://discord.gg/RWzqC3nx7K target=_blank rel=noopener title=discord.gg class=md-social__link><svg viewBox="0 0 640 512"><path d="M524.531 69.836a1.5 1.5.0 00-.764-.7A485 485 0 00404.081 32.03a1.82 1.82.0 00-1.923.91 338 338 0 00-14.9 30.6 447.9 447.9.0 00-134.426.0 310 310 0 00-15.135-30.6 1.89 1.89.0 00-1.924-.91A483.7 483.7.0 00116.085 69.137a1.7 1.7.0 00-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02.0 00.765 1.375 487.7 487.7.0 00146.825 74.189 1.9 1.9.0 002.063-.676A348 348 0 00208.12 430.4a1.86 1.86.0 00-1.019-2.588 321 321 0 01-45.868-21.853 1.885 1.885.0 01-.185-3.126 251 251 0 009.109-7.137 1.82 1.82.0 011.9-.256c96.229 43.917 200.41 43.917 295.5.0a1.81 1.81.0 011.924.233 235 235 0 009.132 7.16 1.884 1.884.0 01-.162 3.126 301.4 301.4.0 01-45.89 21.83 1.875 1.875.0 00-1 2.611 391 391 0 0030.014 48.815 1.86 1.86.0 002.063.7A486 486 0 00610.7 405.729a1.88 1.88.0 00.765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972.0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665.0 53.306 26.82 52.843 59.239.0 32.654-23.41 59.241-52.843 59.241m195.38.0c-28.971.0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667.0 53.307 26.82 52.844 59.239.0 32.654-23.177 59.241-52.844 59.241"/></svg>
</a><a href=https://matrix.to/#/#lite-xl:matrix.org target=_blank rel=noopener title=matrix.to class=md-social__link><svg viewBox="0 0 24 24"><path d="M.632.55v22.9H2.28V24H0V0h2.28v.55zm7.043 7.26v1.157h.033a3.3 3.3.0 011.117-1.024c.433-.245.936-.365 1.5-.365q.81.002 1.481.314c.448.208.785.582 1.02 1.108q.382-.562 1.034-.992.651-.43 1.546-.43.679.0 1.26.167c.388.11.716.286.993.53.276.245.489.559.646.951q.229.587.23 1.417v5.728h-2.349V11.52q0-.43-.032-.812a1.8 1.8.0 00-.18-.66 1.1 1.1.0 00-.438-.448q-.292-.165-.785-.166-.498.0-.803.189a1.4 1.4.0 00-.48.499 2 2 0 00-.231.696 5.6 5.6.0 00-.06.785v4.768h-2.35v-4.8q.002-.38-.018-.752a2.1 2.1.0 00-.143-.688 1.05 1.05.0 00-.415-.503c-.194-.125-.476-.19-.854-.19q-.168.0-.439.074c-.18.051-.36.143-.53.282a1.64 1.64.0 00-.439.595q-.18.39-.18 1.02v4.966H5.46V7.81zm15.693 15.64V.55H21.72V0H24v24h-2.28v-.55z"/></svg></a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base":"../..","features":["navigation.footer","navigation.instant","navigation.tracking","navigation.top","navigation.tabs","content.code.copy","content.action.view","content.action.edit","header.autohide"],"search":"../../assets/javascripts/workers/search.6ce7567c.min.js","translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":{"provider":"mike"}}</script><script src=../../assets/javascripts/bundle.83f73b43.min.js></script><script src=../../javascripts/wade.min.938547.min.js></script><script src=../../javascripts/search.d34b6a.min.js></script><script id=init-glightbox>const lightbox=GLightbox({touchNavigation:!0,loop:!1,zoomable:!0,draggable:!0,openEffect:"zoom",closeEffect:"zoom",slideEffect:"slide"});document$.subscribe(()=>{lightbox.reload()})</script>